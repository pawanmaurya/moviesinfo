var console={};console.log=function(){},$("#result").hide();var imdb={rating:{run:function(a){imdbRating="<p class = 'text-center'><b>"+a.resource.rating+"</b></p>"}}},imdbRating=0,clickCounter=0,index_counter=0,moviesFoundCounter=0;$(document).ready(function(){function g(){var a=document.getElementById("loading");f=setInterval(function(){5==(a.innerHTML+=".").length&&(a.innerHTML="")},500)}function h(){document.getElementById("loading"),clearInterval(f),$("#loading").hide()}function i(){var a='<div class = "alert alert-danger "><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>This site is running in another tab too . Right now only one can run . Will fix this soon </div>';return a}function j(){var a='<div class = "alert alert-danger "><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>No video Files found :( </div>';return a}function k(a){var b='<div class = "alert alert-info "><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+a+' video files are found in your directory. Now searching for movie info.  <span id = "numFoundText" ><span id = "numFound"></span> Movies found </span> <span id = "loading"></span</div>';return b}function l(){s()}function m(a){for(var c,b=["avi","mp4","flv","divx","mov","mkv","webm"],d=[],e=0,f=a.length;f>e;e++)if(c=a[e],extension=c.name.substr((~-c.name.lastIndexOf(".")>>>0)+2),b.indexOf(extension)>=0){var g=c.name.substring(0,c.name.lastIndexOf("."));d.indexOf(g)<0&&d.push(g)}return d}function n(a){function b(a){var b=["dvd","divx","xvid","brrip","r5","unrated","720p","x264","klaxxon","axxo","br_300","300mb","cd1","cd2"," - "];if(a.toLowerCase().indexOf("sample")>=0)return"";a=a.replace(/ \d\d\d\d.*/,""),a=a.replace(/\(.*?\)/g,""),a=a.replace(/\{.*?\}/g,""),a=a.replace(/\[.*?\]/g,""),a=a.replace(/\./g," ");for(var d=0,e=b.length;e>d;d++){var f=new RegExp(b[d]+".*","ig");a=a.replace(f,"")}return a}for(var c=[],d=[],e=0,f=a.length;f>e;e++){var g=b(a[e]);g&&d.indexOf(g)<0&&(c.push({index:e,name:g}),d.push(g))}return c}function o(){var a=$("#example_wrapper").offset();$("html, body").animate({scrollTop:a.top},"slow"),moviesFoundCounter=0,g(),console.log(d),localStorage.setItem("sessionRunning",1),index_counter||t(d[index_counter].name,d[index_counter].index)}function p(a,c){if(0==a.total_pages||!a.results)return console.log("=======no result for "),r(),void 0;var d=a.results,e=d[0].title;console.log("title "+e);var f=d[0].id,g="";$.ajax({url:"http://api.themoviedb.org/3/movie/"+f+"?api_key="+b,dataType:"json",dataType:"jsonp",success:function(a){if(console.log("getMoreMovieInfo"),g=a.imdb_id,!g)return console.log("imdbId not fond"),r(),void 0;var b='<a target="_blank" href = "http://www.imdb.com/title/'+g+'">'+e+"</a>",d="";for(var f in a.genres)d+=a.genres[f].name+" ";$.ajax({type:"GET",url:"http://p.media-imdb.com/static-content/documents/v1/title/"+g+"/ratings%3Fjsonp=imdb.rating.run:imdb.api.title.ratings/data.json",contentType:"application/json",dataType:"jsonp",success:function(){alert(3)},error:function(){console.log("going to push"),q(b,d,g,c)}})},error:function(){console.log("error ========= getMoreMovieInfo"),r()}})}function q(a,b,d,e){var f=JSON.parse(localStorage.getItem("dataTablesData"));f.push({fileName:c[e],movie:a,rating:imdbRating,genres:b,imdbId:d}),localStorage.setItem("dataTablesData",JSON.stringify(f));var g=$("#movieInfo").DataTable();console.log("pushObj"),g.ajax.reload(),$("input[type=search]").css("width","200"),$(".dataTables_filter input").attr("placeholder","Filter by ratings, genres, names"),moviesFoundCounter++,$("#numFound").html("<b> "+moviesFoundCounter+" </b>"),$("#numFoundText").show(),r()}function r(){return index_counter++,index_counter==d.length?(console.log("!!!!!!!!!!!!!! done"),h(),localStorage.setItem("sessionRunning",0),void 0):(t(d[index_counter].name,d[index_counter].index),void 0)}function s(){$("#movieInfo").show(),$("#movieInfo").dataTable({bAutoWidth:!1,sAjaxDataProp:"",bProcessing:!0,oLanguage:{sEmptyTable:"Searching for movie data ..."},order:[[2,"desc"]],aoColumns:[{sWidth:"30%"},{sWidth:"35%"},{sWidth:"5%"},{sWidth:"30%"}],aoColumns:[{mData:"fileName"},{mData:"movie"},{mData:"rating"},{mData:"genres"}],ajax:function(a,b){b(JSON.parse(localStorage.getItem("dataTablesData")))}})}function t(a,c){console.log("starting ==",a);var a,f,d="http://api.themoviedb.org/3/",e="search/movie?query=",g="&api_key="+b;f=encodeURI(a),urlStr=d+e+f+g,$.ajax({type:"GET",url:urlStr,contentType:"application/json",dataType:"jsonp",success:function(a){console.log("getMovieInfo"),p(a,c)},error:function(){console.log("error=============="),r()}})}$("#proxyBtn").click(function(a){a.preventDefault(),$("#fileURL").trigger("click")});var a=document.getElementById("fileURL");a.addEventListener("change",function(a){$("#result").show();var b=localStorage.getItem("sessionRunning");if(console.log(b),1==b)return $("#message").html(i()),void 0;localStorage.clear(),localStorage.setItem("dataTablesData","[]"),e=a.target.files;var e;if(c=m(e),d=n(c),0==d.length)return $("#message").html(j()),void 0;if($("#message").html(k(d.length)),$("#numFoundText").hide(),clickCounter++){localStorage.clear(),localStorage.setItem("dataTablesData","[]");var g=$("#movieInfo").DataTable();g.clear().draw(),index_counter=0}else l();o()},!1),$("#movieInfo").hide();var f,b="c340d5ff1e32511e4584f70860ab018c",c=[],d=[]});
