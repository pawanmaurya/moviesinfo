var imdb={rating:{run:function(e){imdbRating="<p class = 'text-center'><b>"+e.resource.rating+"</b></p>"}}},imdbRating=0,clickCounter=0,index_counter=0,moviesFoundCounter=0;$(document).ready(function(){function e(){var e=document.getElementById("loading");f=setInterval(function(){5==(e.innerHTML+=".").length&&(e.innerHTML="")},500)}function n(){document.getElementById("loading");clearInterval(f),$("#loading").hide()}function t(){var e='<div class = "alert alert-danger "><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>No video Files found :( </div>';return e}function a(e){var n='<div class = "alert alert-info "><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+e+' video files are found in your directory. Now searching for movie info.  <span id = "numFoundText" ><span id = "numFound"></span> Movies found </span> <span id = "loading"></span</div>';return n}function i(){c()}function o(e){for(var n,t=["avi","mp4","flv","divx","mov","mkv","webm"],a=[],i=0,o=e.length;o>i;i++)if(n=e[i],extension=n.name.substr((~-n.name.lastIndexOf(".")>>>0)+2),t.indexOf(extension)>=0){var r=n.name.substring(0,n.name.lastIndexOf("."));a.indexOf(r)<0&&a.push(r)}return a}function r(e){function n(e){var n=["dvd","divx","xvid","brrip","r5","unrated","720p","x264","klaxxon","axxo","br_300","300mb","cd1","cd2"," - "];if(e.toLowerCase().indexOf("sample")>=0)return"";e=e.replace(/ \d\d\d\d.*/,""),e=e.replace(/\(.*?\)/g,""),e=e.replace(/\{.*?\}/g,""),e=e.replace(/\[.*?\]/g,""),e=e.replace(/\./g," ");for(var t=0,a=n.length;a>t;t++){var i=new RegExp(n[t]+".*","ig");e=e.replace(i,"")}return e}for(var t=[],a=[],i=0,o=e.length;o>i;i++){var r=n(e[i]);r&&a.indexOf(r)<0&&(t.push({index:i,name:r}),a.push(r))}return t}function s(){var n=$("#example_wrapper").offset();$("html, body").animate({scrollTop:n.top},"slow"),moviesFoundCounter=0,e(),index_counter||m(b[index_counter].name,b[index_counter].index)}function d(e,n){if(0==e.total_pages||!e.results)return void u();var t=e.results,a=t[0].title,i=t[0].id,o="";$.ajax({url:"http://api.themoviedb.org/3/movie/"+i+"?api_key="+v,dataType:"json",dataType:"jsonp",success:function(e){if(o=e.imdb_id,!o)return void u();var t='<a target="_blank" href = "http://www.imdb.com/title/'+o+'">'+a+"</a>",i="";for(var r in e.genres)i+=e.genres[r].name+" ";$.ajax({type:"GET",url:"http://p.media-imdb.com/static-content/documents/v1/title/"+o+"/ratings%3Fjsonp=imdb.rating.run:imdb.api.title.ratings/data.json",contentType:"application/json",dataType:"jsonp",success:function(){alert(3)},error:function(){l(t,i,o,n)}})},error:function(){u()}})}function l(e,n,t,a){var i=JSON.parse(localStorage.getItem("dataTablesData"));i.push({fileName:g[a],movie:e,rating:imdbRating,genres:n,imdbId:t}),localStorage.setItem("dataTablesData",JSON.stringify(i));var o=$("#movieInfo").DataTable();o.ajax.reload(),$("input[type=search]").css("width","200"),$(".dataTables_filter input").attr("placeholder","Filter by ratings, genres, names"),moviesFoundCounter++,$("#numFound").html("<b> "+moviesFoundCounter+" </b>"),$("#numFoundText").show(),u()}function u(){return index_counter++,index_counter==b.length?void n():void m(b[index_counter].name,b[index_counter].index)}function c(){$("#movieInfo").show(),$("#movieInfo").dataTable({bAutoWidth:!1,sAjaxDataProp:"",bProcessing:!0,oLanguage:{sEmptyTable:"Searching for movie data ..."},order:[[2,"desc"]],aoColumns:[{sWidth:"30%"},{sWidth:"35%"},{sWidth:"5%"},{sWidth:"30%"}],aoColumns:[{mData:"fileName"},{mData:"movie"},{mData:"rating"},{mData:"genres"}],ajax:function(e,n){n(JSON.parse(localStorage.getItem("dataTablesData")))}})}function m(e,n){var e,t,a="http://api.themoviedb.org/3/",i="search/movie?query=",o="&api_key="+v;t=encodeURI(e),urlStr=a+i+t+o,$.ajax({type:"GET",url:urlStr,contentType:"application/json",dataType:"jsonp",success:function(e){d(e,n)},error:function(){u()}})}$("#proxyBtn").click(function(e){e.preventDefault(),$("#fileURL").trigger("click")});var p=document.getElementById("fileURL");p.addEventListener("change",function(e){n=e.target.files;var n;if(g=o(n),b=r(g),0==b.length)return void $("#message").html(t());if($("#message").html(a(b.length)),$("#numFoundText").hide(),clickCounter++){localStorage.clear(),localStorage.setItem("dataTablesData","[]");var d=$("#movieInfo").DataTable();d.clear().draw(),index_counter=0}else i();s()},!1),$("#movieInfo").hide();var f,v="c340d5ff1e32511e4584f70860ab018c",g=[],b=[];localStorage.clear(),localStorage.setItem("dataTablesData","[]")});
